<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>คำนวณราคาทองและเงิน</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans Thai', sans-serif;
      background-color: #f0f0f0;
      color: #333;
      padding: 15px;
      margin: 0;
      box-sizing: border-box;
    }

    .container {
      max-width: 420px; /* Slightly wider to accommodate tabs */
      width: 95%;
      margin: 25px auto 10px auto; /* Added margin-bottom */
      background-color: #ffffff;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .tabs {
      display: flex;
      border-bottom: 1px solid #ccc;
    }

    .tab-button {
      flex: 1;
      padding: 12px 0;
      text-align: center;
      cursor: pointer;
      background-color: #e9e9e9;
      border: none;
      border-top-left-radius: 4px;
      border-top-right-radius: 4px;
      font-size: 1.1em;
      font-weight: 600;
      color: #666;
      transition: background-color 0.2s ease, color 0.2s ease;
    }

    .tab-button.active {
      background-color: #ffffff;
      color: #333;
      border-bottom: 2px solid #5cb85c; /* Green underline for active tab */
      font-weight: 700;
    }

    .tab-button:hover:not(.active) {
      background-color: #f5f5f5;
    }

    .calculator {
      /* This now styles the content inside each tab */
      padding: 20px;
    }

    h2 {
      text-align: center;
      color: #555;
      margin-bottom: 20px;
      font-size: 1.6em;
      font-weight: 600;
    }

    label {
      display: block;
      margin: 10px 0 5px;
      font-weight: 400;
      font-size: 0.95em;
      color: #444;
    }

    input {
      width: calc(100% - 22px);
      padding: 10px;
      border: 1px solid #999;
      border-radius: 3px;
      background-color: #fff;
      color: #333;
      font-size: 1em;
      font-family: 'Noto Sans Thai', sans-serif;
      margin-bottom: 15px;
      outline: none;
      box-sizing: border-box;
    }

    input:focus {
      border-color: #5cb85c;
      box-shadow: 0 0 5px rgba(92,184,92,0.5);
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
    }

    button {
      flex: 1;
      min-width: 120px; /* Adjusted min-width for fewer buttons */
      padding: 12px;
      background-color: #5cb85c;
      color: white;
      border: 1px solid #4cae4c;
      border-radius: 4px;
      font-weight: 600;
      font-size: 1.05em;
      cursor: pointer;
      transition: background-color 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    button.reset-btn {
      background-color: #f0ad4e;
      border-color: #eea236;
    }

    button.reset-btn:hover {
      background-color: #ec971f;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    }

    button.reset-btn:active {
      background-color: #d58512;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
    }

    button:hover {
      background-color: #4cae4c;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    }

    button:active {
      background-color: #449d44;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
    }

    /* Output Section - Hidden by default now */
    .output {
      display: none; /* Hide the in-page output */
    }

    .output p {
      margin: 8px 0;
    }

    /* Popup Styling */
    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .popup-content {
      background-color: #ffffff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      text-align: center;
      max-width: 350px;
      width: 90%;
      position: relative;
    }

    .popup-content h3 {
      color: #555;
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 1.5em;
    }

    .popup-content p {
      font-size: 1.1em;
      margin: 10px 0;
      color: #333;
    }

    .popup-content .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      color: #888;
    }

    .popup-content .close-btn:hover {
      color: #555;
    }

    /* Hide tab content by default */
    .tab-content {
        display: none;
    }
    .tab-content.active {
        display: block;
    }

    /* History Section Styling */
    .history-section {
        background-color: #ffffff;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 20px;
        max-width: 400px;
        width: 95%;
        margin: 20px auto;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .history-section h3 {
        text-align: center;
        color: #555;
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 1.4em;
    }

    .history-list {
        list-style-type: none;
        padding: 0;
        max-height: 300px; /* Limit height and enable scroll */
        overflow-y: auto;
        border: 1px solid #eee;
        border-radius: 3px;
        padding-top: 5px;
        padding-bottom: 5px;
    }

    .history-list li {
        background-color: #f9f9f9;
        margin: 5px 0;
        padding: 10px;
        border-radius: 3px;
        border-bottom: 1px solid #eee;
        font-size: 0.9em;
        color: #555;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .history-list li:last-child {
        border-bottom: none;
    }

    .history-list li strong {
        color: #333;
    }

    .clear-history-btn {
        display: block;
        width: 100%;
        padding: 10px;
        margin-top: 15px;
        background-color: #dc3545; /* Red for clear */
        color: white;
        border: 1px solid #dc3545;
        border-radius: 4px;
        font-weight: 600;
        font-size: 1em;
        cursor: pointer;
        transition: background-color 0.2s ease, box-shadow 0.2s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .clear-history-btn:hover {
      background-color: #c82333;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    }

    .clear-history-btn:active {
      background-color: #bd2130;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
    }

    .price-reference {
        font-size: 0.85em;
        text-align: center;
        margin-top: 15px;
        color: #666;
    }
    .price-reference a {
        color: #007bff;
        text-decoration: none;
        font-weight: 600;
    }
    .price-reference a:hover {
        text-decoration: underline;
    }


    /* Media Queries */
    @media screen and (max-width: 600px) {
      body {
        padding: 10px;
      }

      .container {
        margin: 15px auto;
      }

      .calculator {
        padding: 15px;
      }

      h2 {
        font-size: 1.5em;
        margin-bottom: 15px;
      }

      label {
        font-size: 0.9em;
      }

      input {
        padding: 8px;
        font-size: 0.95em;
        margin-bottom: 10px;
      }

      .button-group {
        flex-direction: column;
        gap: 8px;
      }
      button {
        padding: 10px;
        font-size: 1em;
        min-width: unset; /* Remove min-width on small screens */
      }

      .popup-content {
        padding: 20px;
      }
      .popup-content h3 {
        font-size: 1.3em;
      }
      .popup-content p {
        font-size: 1em;
      }

      .tab-button {
        font-size: 1em;
        padding: 10px 0;
      }

      .history-section {
        padding: 15px;
      }
      .history-section h3 {
        font-size: 1.3em;
      }
      .history-list li {
        font-size: 0.85em;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="tabs">
      <button class="tab-button active" onclick="openTab(event, 'gold')">ทอง</button>
      <button class="tab-button" onclick="openTab(event, 'silver')">เงิน</button>
    </div>

    <div id="gold" class="tab-content active calculator">
      <h2>เครื่องคำนวณราคาทอง</h2>

      <label for="goldPrice">ราคาทอง ณ ปัจจุบัน (บาท):</label>
      <input type="number" id="goldPrice" placeholder="กรอกราคาทอง เช่น 34000">

      <label for="goldAdditionalPrice">บวกราคาเพิ่ม (บาท):</label>
      <input type="number" id="goldAdditionalPrice" placeholder="กรอกราคาที่ต้องการบวก เช่น 500 (ไม่กรอกก็ได้)">

      <label for="goldPercentage">เปอร์เซ็นต์ทอง (%):</label>
      <input type="number" id="goldPercentage" placeholder="กรอกเปอร์เซ็นต์ เช่น 96.5 หรือ 100">

      <label for="goldWeight">น้ำหนักทอง (กรัม):</label>
      <input type="number" id="goldWeight" placeholder="กรอกน้ำหนัก (ถ้ามี) เช่น 10">

      <div class="button-group">
        <button onclick="calculate('gold')">คำนวณ</button>
        <button type="button" class="reset-btn" onclick="resetCalculator('gold')">รีเซ็ต</button>
      </div>

      <p class="price-reference">
        อ้างอิงราคาทองคำจาก: <a href="https://thaigold.info/" target="_blank">ThaiGold.info</a>
      </p>
    </div>

    <div id="silver" class="tab-content calculator">
      <h2>เครื่องคำนวณราคาแร่เงิน</h2>

      <label for="silverPrice">ราคาแร่เงิน ณ ปัจจุบัน (บาท/กรัม):</label>
      <input type="number" id="silverPrice" placeholder="กรอกราคาแร่เงิน เช่น 30">

      <label for="silverPercentage">เปอร์เซ็นต์เงิน (%):</label>
      <input type="number" id="silverPercentage" placeholder="กรอกเปอร์เซ็นต์ เช่น 99.9 หรือ 92.5">

      <label for="silverWeight">น้ำหนักแร่เงิน (กรัม):</label>
      <input type="number" id="silverWeight" placeholder="กรอกน้ำหนัก (ถ้ามี) เช่น 50">

      <div class="button-group">
        <button onclick="calculate('silver')">คำนวณ</button>
        <button type="button" class="reset-btn" onclick="resetCalculator('silver')">รีเซ็ต</button>
      </div>
    </div>

    <div class="output" style="display: none;">
      <p id="pricePerGram">ราคาต่อกรัม: - บาท</p>
      <p id="result">ราคาทองที่ต้องจ่าย: - บาท</p>
    </div>
  </div>

  <div class="history-section" id="historySection">
    <h3>ประวัติการคำนวณ</h3>
    <ul id="calculationHistoryList" class="history-list">
      </ul>
    <button type="button" class="clear-history-btn" onclick="clearHistory()">ล้างประวัติ</button>
  </div>


  <div class="popup-overlay" id="resultsPopup">
    <div class="popup-content">
      <span class="close-btn" onclick="closePopup()">&times;</span>
      <h3 id="popupTitle">ผลการคำนวณ</h3>
      <p id="popupPricePerGram">ราคาต่อกรัม: - บาท</p>
      <p id="popupResult">ราคาที่ต้องจ่าย: - บาท</p>
    </div>
  </div>

  <script>
    // Function to switch tabs
    function openTab(evt, tabName) {
      let i, tabcontent, tabbuttons;

      tabcontent = document.getElementsByClassName("tab-content");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }

      tabbuttons = document.getElementsByClassName("tab-button");
      for (i = 0; i < tabbuttons.length; i++) {
        tabbuttons[i].className = tabbuttons[i].className.replace(" active", "");
      }

      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
    }

    // Generic calculate function for both gold and silver
    function calculate(metalType) {
      let mainPrice, additionalPriceInput, percentageInput, weightInput;
      let effectivePrice, pricePerGramRaw, pricePerGram, totalPrice = 0;
      let percentage, weight;
      let popupTitleText;

      // Get values based on metal type
      if (metalType === 'gold') {
        mainPrice = parseFloat(document.getElementById('goldPrice').value);
        additionalPriceInput = document.getElementById('goldAdditionalPrice').value;
        percentageInput = document.getElementById('goldPercentage').value;
        weightInput = document.getElementById('goldWeight').value;
        popupTitleText = 'ผลการคำนวณราคาทอง';
      } else if (metalType === 'silver') {
        mainPrice = parseFloat(document.getElementById('silverPrice').value);
        additionalPriceInput = ""; // Explicitly set to empty for silver as there's no input field
        percentageInput = document.getElementById('silverPercentage').value;
        weightInput = document.getElementById('silverWeight').value;
        popupTitleText = 'ผลการคำนวณราคาแร่เงิน';
      }

      // Parse weight early
      weight = parseFloat(weightInput);
      percentage = parseFloat(percentageInput);

      // Input validation (common for both)
      if (isNaN(mainPrice) || mainPrice <= 0) {
        alert(`กรุณากรอก 'ราคา${metalType === 'gold' ? 'ทอง' : 'แร่เงิน'} ณ ปัจจุบัน' ให้ถูกต้องและเป็นจำนวนบวก`);
        return;
      }
      if (isNaN(percentage) || percentage <= 0 || percentage > 100) {
        alert(`กรุณากรอก 'เปอร์เซ็นต์${metalType === 'gold' ? 'ทอง' : 'เงิน'}' ให้ถูกต้อง (1-100)`);
        return;
      }

      // Only validate additionalPrice for gold, as it's not present for silver
      let additionalPrice = 0; // Default to 0 if not used
      if (metalType === 'gold') {
          additionalPrice = additionalPriceInput === "" ? 0 : parseFloat(additionalPriceInput);
          if (isNaN(additionalPrice) || additionalPrice < 0) {
              alert("กรุณากรอก 'บวกราคาเพิ่ม' ให้ถูกต้อง (เป็นตัวเลข หรือเว้นว่าง)");
              return;
          }
      }
      // For silver, additionalPrice remains 0 or is not added at all.

      effectivePrice = mainPrice + additionalPrice; // additionalPrice will be 0 for silver here

      // Calculation logic based on metal type
      if (metalType === 'gold') {
        // 1 บาททอง = 15.244 กรัม
        pricePerGramRaw = (effectivePrice / 15.244) * (percentage / 100);
        pricePerGram = Math.floor(pricePerGramRaw); // Gold still floors to whole number
      } else if (metalType === 'silver') {
        // Silver calculation: current price per gram * percentage (no additional price here)
        pricePerGramRaw = mainPrice * (percentage / 100); // Only use mainPrice for silver calculation
        pricePerGram = parseFloat(pricePerGramRaw.toFixed(1)); // Round to 1 decimal place for silver
      }
      
      // Calculate total price if weight is provided
      if (weightInput !== "" && !isNaN(weight) && weight > 0) {
        if (metalType === 'silver') {
            totalPrice = (pricePerGram * weight).toFixed(1); // Keep 1 decimal for total silver price
        } else {
            totalPrice = pricePerGram * weight; // Gold remains whole number
        }
      } else {
          totalPrice = 0; // Ensure total price is 0 if no valid weight for display
      }


      // Display results in popup
      document.getElementById('popupTitle').textContent = popupTitleText;
      document.getElementById('popupPricePerGram').textContent =
        `ราคาต่อกรัม: ${pricePerGram.toLocaleString(undefined, { minimumFractionDigits: metalType === 'silver' ? 1 : 0, maximumFractionDigits: metalType === 'silver' ? 1 : 0 })} บาท`;

      document.getElementById('popupResult').textContent =
        totalPrice > 0 ? `ราคาที่ต้องจ่าย: ${parseFloat(totalPrice).toLocaleString(undefined, { minimumFractionDigits: metalType === 'silver' ? 1 : 0, maximumFractionDigits: metalType === 'silver' ? 1 : 0 })} บาท` : `ราคาที่ต้องจ่าย: - บาท (กรุณากรอกน้ำหนัก)`;

      // Show the popup
      document.getElementById('resultsPopup').style.display = 'flex';

      // **Auto-save logic: Only save if weight is entered and valid**
      if (weightInput !== "" && !isNaN(weight) && weight > 0) {
          const historyList = document.getElementById('calculationHistoryList');
          const listItem = document.createElement('li');
          let historyEntryText = "";

          if (metalType === 'gold') {
              historyEntryText = `ทอง ${percentage.toLocaleString()}% - ${weight.toLocaleString()}g: ${totalPrice.toLocaleString()} บาท (${pricePerGram.toLocaleString()} บาท/กรัม)`;
              if (additionalPrice > 0) {
                  historyEntryText += ` (+${additionalPrice.toLocaleString()}บ.)`;
              }
          } else if (metalType === 'silver') {
              historyEntryText = `เงิน ${percentage.toLocaleString()}% - ${weight.toLocaleString()}g: ${parseFloat(totalPrice).toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 })} บาท (${pricePerGram.toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 })} บาท/กรัม)`;
          }
          listItem.textContent = historyEntryText;
          historyList.prepend(listItem); // Add to the top of the list
      }
    }

    function closePopup() {
      document.getElementById('resultsPopup').style.display = 'none';
    }

    // Function to clear calculation history
    function clearHistory() {
        if (confirm("คุณแน่ใจหรือไม่ที่ต้องการล้างประวัติการคำนวณทั้งหมด?")) {
            document.getElementById('calculationHistoryList').innerHTML = '';
        }
    }

    // Set initial active tab
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('gold').style.display = 'block';
    });
  </script>

</body>
</html>
