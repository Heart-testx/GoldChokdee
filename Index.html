<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏ô PDF */
        .pdf-content {
            padding: 20px;
            border: 1px solid #ccc;
            background-color: #fff;
        }
        .signature-area {
            border: 1px dashed #000;
            height: 80px;
            width: 100%;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            color: #6c757d;
        }
    </style>
</head>
<body>

<div class="container my-5">
    <h1 class="mb-4 text-primary">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤</h1>
    <p class="alert alert-info">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF</p>
    
    <div id="record-form" class="pdf-content shadow-lg">
        
        <h2 class="h4 border-bottom pb-2 mb-3">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢</h2>
        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <label for="sellerName" class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ã‡πá‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£)</label>
                <input type="text" class="form-control" id="sellerName" placeholder="‡∏ô‡∏≤‡∏¢/‡∏ô‡∏≤‡∏á/‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß..." required>
            </div>
            <div class="col-md-6">
                <label for="sellerPhone" class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                <input type="tel" class="form-control" id="sellerPhone" placeholder="0X-XXX-XXXX" required>
            </div>
            <div class="col-md-6">
                <label for="recordDate" class="form-label">‡∏ß‡∏±‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</label>
                <input type="datetime-local" class="form-control" id="recordDate" required>
            </div>
            <div class="col-md-6">
                <label for="price" class="form-label">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡∏•‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
                <input type="number" class="form-control" id="price" placeholder="‡πÄ‡∏ä‡πà‡∏ô 25,000" required>
            </div>
        </div>

        <h3 class="h5 border-bottom pb-2 mb-3">üì∏ ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏•‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</h3>
        <div class="mb-4">
            <input class="form-control" type="file" id="photoUpload" accept="image/*" multiple onchange="handleImageUpload(event)">
            <p class="form-text">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏•‡∏≠‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏π‡∏õ‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢</p>
            <div id="image-preview" class="d-flex flex-wrap gap-3 mt-3">
                </div>
        </div>
        
        <h3 class="h5 border-bottom pb-2 mb-3">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠</h3>
        <div class="table-responsive">
            <table class="table table-bordered align-middle" id="metalTable">
                <thead class="table-primary">
                    <tr>
                        <th scope="col">‡πÅ‡∏£‡πà</th>
                        <th scope="col">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏£‡∏±‡∏°)</th>
                        <th scope="col">% ‡∏Ç‡∏≠‡∏á‡πÅ‡∏£‡πà (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏£‡∏¥‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡πå)</th>
                        <th scope="col">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏£‡πâ‡∏≠‡∏¢, ‡∏Å‡∏£‡∏≠‡∏ö‡∏û‡∏£‡∏∞)</th>
                        <th scope="col">‡∏•‡∏ö</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="row-1">
                        <td>
                            <select class="form-select metal-type" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏£‡πà</option>
                                <option>‡∏ó‡∏≠‡∏á</option>
                                <option>‡πÅ‡∏£‡πà‡πÄ‡∏á‡∏¥‡∏ô</option>
                                <option>‡∏ô‡∏≤‡∏Å</option>
                                <option>‡πÅ‡∏û‡∏•‡∏ï‡∏ï‡∏¥‡∏ô‡∏±‡πà‡∏°</option>
                                <option>‡πÇ‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏°</option>
                                <option>‡∏û‡∏≤‡∏£‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏°</option>
                            </select>
                        </td>
                        <td><input type="number" step="0.01" class="form-control item-weight" placeholder="0.00" required></td>
                        <td><input type="number" step="0.01" class="form-control item-percentage" placeholder="0.00" required></td>
                        <td><input type="text" class="form-control item-detail" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏£‡∏≠‡∏ö‡∏û‡∏£‡∏∞, ‡∏™‡∏£‡πâ‡∏≠‡∏¢‡∏Ñ‡∏≠‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥" required></td>
                        <td><button type="button" class="btn btn-danger btn-sm" onclick="removeRow('row-1')">X</button></td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="btn btn-success btn-sm" onclick="addRow()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
        </div>

        <div class="row mt-5">
            <div class="col-md-6">
                <p class="mb-1">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢:</p>
                <div class="signature-area">
                    (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏•‡∏≤‡∏¢‡∏°‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤)
                </div>
            </div>
            <div class="col-md-6">
                <p class="mb-1">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠:</p>
                <div class="signature-area">
                    (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏•‡∏≤‡∏¢‡∏°‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤)
                </div>
            </div>
        </div>

    </div>
    
    <div class="text-center mt-5">
        <button id="generatePdfBtn" class="btn btn-primary btn-lg" onclick="generatePDF()">
            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå PDF ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå
        </button>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
    // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß
    let rowCount = 1;

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    function addRow() {
        rowCount++;
        const tableBody = document.querySelector('#metalTable tbody');
        const newRowId = `row-${rowCount}`;
        const newRow = document.createElement('tr');
        newRow.id = newRowId;
        newRow.innerHTML = `
            <td>
                <select class="form-select metal-type" required>
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏£‡πà</option>
                    <option>‡∏ó‡∏≠‡∏á</option>
                    <option>‡πÅ‡∏£‡πà‡πÄ‡∏á‡∏¥‡∏ô</option>
                    <option>‡∏ô‡∏≤‡∏Å</option>
                    <option>‡πÅ‡∏û‡∏•‡∏ï‡∏ï‡∏¥‡∏ô‡∏±‡πà‡∏°</option>
                    <option>‡πÇ‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏°</option>
                    <option>‡∏û‡∏≤‡∏£‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏°</option>
                </select>
            </td>
            <td><input type="number" step="0.01" class="form-control item-weight" placeholder="0.00" required></td>
            <td><input type="number" step="0.01" class="form-control item-percentage" placeholder="0.00" required></td>
            <td><input type="text" class="form-control item-detail" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏£‡πâ‡∏≠‡∏¢, ‡πÅ‡∏´‡∏ß‡∏ô‡πÄ‡∏û‡∏ä‡∏£" required></td>
            <td><button type="button" class="btn btn-danger btn-sm" onclick="removeRow('${newRowId}')">X</button></td>
        `;
        tableBody.appendChild(newRow);
    }

    // ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    function removeRow(rowId) {
        const row = document.getElementById(rowId);
        if (row) {
            row.remove();
        }
    }

    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
    function handleImageUpload(event) {
        const previewDiv = document.getElementById('image-preview');
        previewDiv.innerHTML = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏£‡∏π‡∏õ‡πÄ‡∏Å‡πà‡∏≤
        const files = event.target.files;

        if (files) {
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const imgContainer = document.createElement('div');
                    imgContainer.className = 'p-1 border shadow-sm';
                    
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.maxWidth = '150px';
                    img.style.maxHeight = '150px';
                    img.className = 'img-fluid';
                    imgContainer.appendChild(img);
                    previewDiv.appendChild(imgContainer);
                };
                reader.readAsDataURL(file);
            });
        }
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF
    async function generatePDF() {
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢)
        const form = document.getElementById('record-form');
        // if (!form.checkValidity()) {
        //     alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        //     return;
        // }

        const inputElements = form.querySelectorAll('input, select, textarea');
        let isValid = true;
        inputElements.forEach(input => {
            if (input.hasAttribute('required') && input.value.trim() === '') {
                isValid = false;
            }
        });
        if (!isValid) {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á PDF!');
            return;
        }

        const element = document.getElementById('record-form');
        const fileName = `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢_${document.getElementById('sellerName').value || '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'}_${new Date().toISOString().slice(0, 10)}.pdf`;

        // 1. ‡πÉ‡∏ä‡πâ html2canvas ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á HTML ‡πÄ‡∏õ‡πá‡∏ô Canvas (‡∏†‡∏≤‡∏û)
        const canvas = await html2canvas(element, { 
            scale: 2, // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
            logging: true, 
            useCORS: true 
        });

        // 2. ‡πÅ‡∏õ‡∏•‡∏á Canvas ‡πÄ‡∏õ‡πá‡∏ô Data URL
        const imgData = canvas.toDataURL('image/png');
        
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4'); // 'p' (Portrait), 'mm' (‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏•‡∏•‡∏¥‡πÄ‡∏°‡∏ï‡∏£), 'a4'

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡∏†‡∏≤‡∏û‡πÉ‡∏ô PDF (A4 size: 210mm x 297mm)
        const imgWidth = 210 - 20; // 190mm (‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ç‡∏≠‡∏ö 10mm ‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏ß‡∏≤)
        const pageHeight = 297;
        const imgHeight = canvas.height * imgWidth / canvas.width;
        let heightLeft = imgHeight;
        
        let position = 10; // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á Y ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡πâ‡∏≤‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
        pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;

        while (heightLeft >= 0) {
            position = heightLeft - imgHeight + 10;
            pdf.addPage();
            pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
        }

        pdf.save(fileName);
    }
</script>

</body>
</html>
